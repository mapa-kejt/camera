<!DOCTYPE html>
<html>
  <head> 
    <title>Hello Camera</title>
    <script src="https://unpkg.com/dynamsoft-camera-enhancer@2.1.0/dist/dce.js"></script>
    <script src="https://unpkg.com/qr-scanner/qr-scanner.min.js"></script>
  </head>
  <body>
    <button id="capture">Capture</button>
    <div id="enhancerUIContainer" style="height: 100vh"></div>

    <script>
      let enhancer = null;
      let video = null;
      let scanner = null;

      async function setupCamera() {
        const videoElement = document.createElement("video");
        videoElement.width = 640;
        videoElement.height = 480;

        const stream = await navigator.mediaDevices.getUserMedia({
          video: true,
        });

        videoElement.srcObject = stream;
        await videoElement.play();

        return videoElement;
      }

      async function detectQRCode(frame) {
        try {
          const qrCode = await scanner.scanImage(frame);
          if (qrCode && qrCode.length > 0) {
            const qrData = qrCode[0].data;
            if (qrData === " Crkva sv.Stosije") {
              // Replace with the QR code data you want to detect
              const videoUrl = "images/video.mp4"; // Replace with the URL or path to your video
              window.open(videoUrl);
            }
          }
        } catch (error) {
          console.error(error);
        }
      }

      async function main() {
        enhancer = await Dynamsoft.DCE.CameraEnhancer.createInstance();
        document
          .getElementById("enhancerUIContainer")
          .appendChild(enhancer.getUIElement());
        await enhancer.open(true);

        video = await setupCamera();

        scanner = new window.QRScanner(video, (result) => {
          console.log("QR Code detected:", result);
        });

        setInterval(async () => {
          const frame = enhancer.getFrame();
          detectQRCode(frame);
        }, 1000);
      }

      document.getElementById("capture").onclick = main;
    </script>
  </body>
</html>
