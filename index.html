<!DOCTYPE html>
<html>
  <head>
    <title>Object Detection Web App</title>
    <style>
      #video-container {
        display: none;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
  </head>
  <body>
    <button onclick="openCamera()">Open Camera</button>
    <div id="video-container">
      <video id="video-player" width="640" height="480" controls></video>
    </div>

    <script>
      let videoContainer = document.getElementById("video-container");
      let videoPlayer = document.getElementById("video-player");
      let objectDetected = false;

      async function openCamera() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: true,
          });
          let video = document.createElement("video");
          video.srcObject = stream;
          video.addEventListener("loadedmetadata", function () {
            video.play();
            processVideo(video);
          });
        } catch (error) {
          console.log("Unable to access the camera: " + error.message);
        }
      }

      async function loadModel() {
        try {
          const model = await cocoSsd.load();
          return model;
        } catch (error) {
          console.log(
            "Unable to load the object detection model: " + error.message
          );
        }
      }

      async function processVideo(video) {
        let canvas = document.createElement("canvas");
        let context = canvas.getContext("2d");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        let model = await loadModel();

        function detectObjects() {
          context.drawImage(video, 0, 0, canvas.width, canvas.height);
          let imageData = context.getImageData(
            0,
            0,
            canvas.width,
            canvas.height
          );

          model.detect(imageData).then(function (predictions) {
            objectDetected = false;
            predictions.forEach(function (prediction) {
              if (prediction.class === "church") {
                objectDetected = true;
              }
            });

            if (objectDetected) {
              // Display the video container and play the video
              videoContainer.style.display = "block";
              videoPlayer.src = "images/video.mp4";
              videoPlayer.play();
            }

            requestAnimationFrame(detectObjects);
          });
        }

        detectObjects();
      }
    </script>
  </body>
</html>
